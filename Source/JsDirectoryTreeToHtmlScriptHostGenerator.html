<html>
<body>

<div id="divUi">
	<h3>JavaScript Directory Tree To HTML Script Host Generator</h3>

	<p>
		Given an indented text representation of a file/directory hierarchy tree,
		this program generates an HTML file to run a JavaScript programs
		consisting of a large number of script files.  (It can also generate
		a TypeScript .ts file to import classes defined in those files
		from a single namespace.)
	</p>

	<p>
		Directory listings in the expected format can behind
		obtained by running the command "tree /a /f &gt; Tree.txt" 
		from a Windows command prompt.
		A demo file is provided in this repository, at
		<a href='../Demo/GameFrameworkTS-DirectoryTree.txt'>this link</a>.
	</p>

	<div>
		<label for="textareaDirectoryTree">
			Directories and Files as Tree:
		</label>
		<input
			type="file"
			onchange="UiEventHandler.inputFile_Changed(this)"
		></input>
		<br />
		<textarea
			id="textareaDirectoryTree"
			cols="80" rows="16"
		></textarea>
	</div>

	<div>
		<button
			onclick="UiEventHandler.buttonGenerate_Clicked()"
		>
			Generate
		</button>
		<select id="selectCodeType">
			<option>HTML Script Host</option>
			<option>Import-Classes-from-Namespace .ts</option>
		</select>
	</div>

	<div>
		<label for="textareaGeneratedHtml">
			Generated Code:
		</label>
		<br />
		<textarea
			id="textareaCodeGenerated"
			cols="80" rows="16"
		></textarea>
	</div>

</div>

<script type="text/javascript">

class UiEventHandler
{
	static buttonGenerate_Clicked()
	{
		var d = document;
		var textareaDirectoryTree =
			d.getElementById("textareaDirectoryTree");

		var directoryTreeAsString =
			textareaDirectoryTree.value;

		var directoryTreeRoot =
			DirectoryTreeNode.fromString(directoryTreeAsString);

		var generator =
			new CodeFromDirectoryTreeGenerator(directoryTreeRoot);

		var selectCodeType =
			d.getElementById("selectCodeType");
		var codeTypeName = selectCodeType.value;

		var codeGenerated =
			codeTypeName == "HTML Script Host"
			? generator.generateHtmlScriptHost()
			: codeTypeName == "Import-Classes-from-Namespace .ts"
			? generator.generateTypeScriptImportClassesFromNamespace()
			: "Error: Unrecognized Code Type: " + codeTypeName + ".";

		var textareaCodeGenerated =
			d.getElementById("textareaCodeGenerated");
		textareaCodeGenerated.value = codeGenerated;

		var generator = new CodeFromDirectoryTreeGenerator();
	}

	static inputFile_Changed(inputFile)
	{
		var file = inputFile.files[0];
		if (file != null)
		{
			var fileReader = new FileReader();
			fileReader.onload = (event) =>
			{
				var fileText = event.target.result;
				var d = document;
				var textareaDirectoryTree =
					d.getElementById("textareaDirectoryTree");
				textareaDirectoryTree.value = fileText;
			};
			fileReader.readAsText(file);
		}
	}
}

// Classes.

class CodeFromDirectoryTreeGenerator
{
	constructor(directoryTreeRoot)
	{
		this.directoryTreeRoot = directoryTreeRoot;
	}

	generateHtmlScriptHost()
	{
		var lines = [];

		lines.push("<html>");
		lines.push("<body>");

		var directoryTreeAsHtml =
			this.directoryTreeRoot.toStringHtmlScriptElements();

		lines.push(directoryTreeAsHtml);

		lines.push("</body>");
		lines.push("<html>");

		var newline = "\n";
		var text = lines.join(newline);

		return text;
	}

	generateTypeScriptImportClassesFromNamespace()
	{
		var lines = [];

		lines.push("import ns = [your namespace here];");
		lines.push("");

		var directoryTreeAsTypeScriptImports =
			this.directoryTreeRoot.toStringTypeScriptImportClassesFromNamespace();

		lines.push(directoryTreeAsTypeScriptImports);

		var newline = "\n";
		var text = lines.join(newline);

		return text;
	}
}

class DirectoryTreeNode
{
	constructor(directoryName, filesInDirectoryNames, children)
	{
		this.directoryName = directoryName;
		this.filesInDirectoryNames = filesInDirectoryNames;
		this.children = children.map(x => x.parentSet(this) );
	}

	static create()
	{
		return new DirectoryTreeNode("", [], []);
	}

	static fromDirectoryName(directoryName)
	{
		return new DirectoryTreeNode(directoryName, [], []);
	}

	static fromString(directoryTreeAsString)
	{
		var newline = "\n";
		var directoryTreeAsLines =
			directoryTreeAsString.split(newline);

		// Remove any lines for non-JavaScript files.
		directoryTreeAsLines =
			directoryTreeAsLines.filter
			(
				line =>
					line.indexOf(".") == -1
					|| line.endsWith(".js")
			);
		
		// Remove the characters representing lines in a diagram.
		directoryTreeAsLines =
			directoryTreeAsLines.map
			(
				x => 
					x
					.split("|").join(" ")
					.split("+").join(" ")
					.split("-").join(" ")
					.split("\\").join(" ")
			);

		// Remove any blank lines.
		directoryTreeAsLines =
			directoryTreeAsLines.filter(x => x.trim() != "");

		// Replace spaces with tabs.
		directoryTreeAsLines =
			directoryTreeAsLines.map
			(
				x => x.split("    ").join("\t")
			);

		// Remove any lines with no identation.
		directoryTreeAsLines =
			directoryTreeAsLines.filter(x => x.startsWith("\t") );

		var treeNodeRoot = DirectoryTreeNode.create();
		var treeNodeCurrent = treeNodeRoot;

		for (var i = 0; i < directoryTreeAsLines.length; i++)
		{
			var line = directoryTreeAsLines[i];

			var indentsOnThisLine = 0;

			while (line.startsWith("\t") )
			{
				indentsOnThisLine++;
				line = line.substr(1);
			}

			if (line.endsWith(".js") )
			{
				treeNodeCurrent.fileInDirectoryNameAdd(line);
			}
			else
			{
				var treeNodeForLine =
					DirectoryTreeNode.fromDirectoryName(line);

				var treeNodeCurrentDepth = treeNodeCurrent.depth();

				if (indentsOnThisLine > treeNodeCurrentDepth)
				{
					treeNodeCurrent.childAdd(treeNodeForLine);
					treeNodeCurrent = treeNodeForLine;
				}
				else if (indentsOnThisLine < treeNodeCurrentDepth)
				{
					treeNodeCurrent = treeNodeCurrent.parent;
					treeNodeCurrent.childAdd(treeNodeForLine);
				}
				else
				{
					// Former directory was empty?
					treeNodeCurrent.childAdd(treeNodeForLine);
				}
			}
		}

		return treeNodeRoot;
	}

	static fromParent(parent)
	{
		return DirectoryTreeNode.create().parentSet(parent);
	}

	childAdd(child)
	{
		this.children.push(child);
	}

	depth()
	{
		if (this._depth == null)
		{
			this._depth =
				this.parent == null
				? 0
				: this.parent.depth() + 1;
		}
		return this._depth;
	}

	directoryPath()
	{
		if (this._directoryPath == null)
		{
			this._directoryPath =
				this.parent == null
				? ""
				: this.parent.directoryPath() + this.directoryName + "/";
		}
		return this._directoryPath;
	}

	fileInDirectoryNameAdd(fileName)
	{
		this.filesInDirectoryNames.push(fileName);
	}

	parentSet(value)
	{
		this.parent = value;
		this._directoryPath = null;
		return this;
	}

	toStringHtmlScriptElements()
	{
		var directoryPath = this.directoryPath();

		var filesAsHtmlStrings =
			this.filesInDirectoryNames.map
			(
				x =>
					"<script type='text/javascript'"
					+ " src='" + directoryPath + x + "'"
					+ " />"
			);
		var childrenAsHtmlStrings =
			this.children.map(x => x.toStringHtmlScriptElements() );

		var thisAndDescendantsAsStrings = [];
		thisAndDescendantsAsStrings.push(...filesAsHtmlStrings);
		thisAndDescendantsAsStrings.push(...childrenAsHtmlStrings);

		var newline = "\n";
		var thisAndDescendantsAsString =
			thisAndDescendantsAsStrings.join(newline);

		return thisAndDescendantsAsString;
	}

	toStringTypeScriptImportClassesFromNamespace()
	{
		var directoryPath = this.directoryPath();

		var filesAsImportLines =
			this.filesInDirectoryNames.map
			(
				x =>
				{
					var className = x.split(".")[0];
					var returnValue =
						"import " + className + " = ns." + className + ";";
					return returnValue;
				}
			);
		var childrenAsImportLines =
			this.children.map
			(
				x => x.toStringTypeScriptImportClassesFromNamespace()
			);

		var thisAndDescendantsAsStrings = [];
		thisAndDescendantsAsStrings.push(...filesAsImportLines);
		thisAndDescendantsAsStrings.push(...childrenAsImportLines);

		var newline = "\n";
		var thisAndDescendantsAsString =
			thisAndDescendantsAsStrings.join(newline);

		return thisAndDescendantsAsString;
	}
}

// Demo.

class DemoData
{
	static todo()
	{

		return 
	}
}


</script>
</body>
</html>

